<!DOCTYPE html>
<html>
<head>
  <title>Blicket Game</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f0f0;
    }
    .hidden {
      display: none;
    }
    .confetti {
      animation: pop 0.6s ease-out;
      font-size: 2em;
    }
    @keyframes pop {
      0% { transform: scale(2); opacity: 0; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
    .tabs button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 1em;
    }
  </style>
</head>
<body>

  <!-- Login UI -->
  <div id="loginScreen">
    <h1>Welcome to Blicket</h1>
    <input id="usernameInput" placeholder="Enter username">
    <button onclick="login()">Login</button>
  </div>

  <!-- Main Game UI -->
  <div id="mainGame" class="hidden">
    <h2 id="welcomeMsg"></h2>
    <div class="tabs">
      <button onclick="showTab('packOpener')">Open Packs</button>
      <button onclick="showTab('locker')">Locker</button>
      <button onclick="showTab('trade')">Trade</button>
      <button onclick="logout()">Logout</button>
    </div>

    <!-- Pack Opener -->
    <div id="packOpener">
      <h3>Choose a Pack:</h3>
      <select id="packSelect">
        <option value="Emojis">Emojis Pack</option>
        <option value="Business">Business Pack</option>
        <option value="Exotics">Exotics Pack</option>
        <option value="Sports">Sports Pack</option>
      </select>
      <button onclick="openPack()">Open Pack</button>
      <h3 id="packResult"></h3>
    </div>

    <!-- Locker -->
    <div id="locker" class="hidden">
      <h3>Your Locker</h3>
      <div id="lockerDisplay"></div>
    </div>

    <!-- Trading -->
    <div id="trade" class="hidden">
      <h3>Trade Blooks</h3>
      <input id="targetUser" placeholder="Recipient Username"><br><br>
      <input id="blookToSend" placeholder="Blook Emoji to Send"><br><br>
      <button onclick="tradeBlook()">Send Trade</button>
      <p id="tradeMsg"></p>
    </div>
  </div>

  <script>
    const packs = {
      Emojis: [
        { blook: "😩", chance: 18.75 }, { blook: "😕", chance: 18.75 },
        { blook: "🤨", chance: 18.75 }, { blook: "😗", chance: 18.75 },
        { blook: "🤓", chance: 8.5 }, { blook: "😍", chance: 8.5 },
        { blook: "😎", chance: 6 }, { blook: "🤯", chance: 0.9 },
        { blook: "🤬", chance: 0.1 }
      ],
      Business: [
        { blook: "🏷️", chance: 18.75 }, { blook: "📅", chance: 18.75 },
        { blook: "📊", chance: 18.75 }, { blook: "💼", chance: 18.75 },
        { blook: "💳", chance: 8.5 }, { blook: "🗑️", chance: 8.5 },
        { blook: "💻", chance: 6 }, { blook: "👨🏻‍💼", chance: 0.95 },
        { blook: "🛒", chance: 0.05 }
      ],
      Exotics: [
        { blook: "🩵", chance: 16.25 }, { blook: "🤹‍♀️", chance: 16.25 },
        { blook: "🎬", chance: 16.25 }, { blook: "🚛", chance: 16.25 },
        { blook: "🚀", chance: 12.5 }, { blook: "🛳️", chance: 12.5 },
        { blook: "🗽", chance: 8 }, { blook: "🌋", chance: 1.79 },
        { blook: "📀", chance: 0.006 }, { blook: "💿", chance: 0.004 }
      ],
      Sports: [
        { blook: "⚽", chance: 18 }, { blook: "🏀", chance: 18 },
        { blook: "🏈", chance: 18 }, { blook: "⚾", chance: 18 },
        { blook: "🥊", chance: 6.25 }, { blook: "🎾", chance: 6.25 },
        { blook: "🏒", chance: 6.25 }, { blook: "🏆", chance: 3.125 },
        { blook: "🧢", chance: 3.125 }, { blook: "🥇", chance: 1.799963 },
        { blook: "🥏", chance: 0.2 }, { blook: "🏄", chance: 0.000037 }
      ]
    };

    function login() {
      const username = document.getElementById('usernameInput').value.trim();
      if (!username) return alert("Enter a username.");
      localStorage.setItem("blicketUser", username);
      showMain(username);
    }

    function logout() {
      document.getElementById('mainGame').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
    }

    function showMain(username) {
      document.getElementById('welcomeMsg').textContent = `Hello, ${username}!`;
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainGame').classList.remove('hidden');
      showTab('packOpener');
      updateLocker();
    }

    function showTab(tabId) {
      ['packOpener', 'locker', 'trade'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(tabId).classList.remove('hidden');
      if (tabId === 'locker') updateLocker();
    }

    function openPack() {
      const username = localStorage.getItem("blicketUser");
      const packName = document.getElementById('packSelect').value;
      const blook = getRandomBlook(packs[packName]);
      document.getElementById('packResult').innerHTML = `<span class='confetti'>🎉 ${blook} 🎉</span>`;
      let userData = JSON.parse(localStorage.getItem("blicket_" + username)) || {};
      userData[blook] = (userData[blook] || 0) + 1;
      localStorage.setItem("blicket_" + username, JSON.stringify(userData));
      updateLocker();
    }

    function getRandomBlook(blookArray) {
      const roll = Math.random() * 100;
      let total = 0;
      for (let b of blookArray) {
        total += b.chance;
        if (roll <= total) return b.blook;
      }
      return blookArray[blookArray.length - 1].blook;
    }

    function updateLocker() {
      const username = localStorage.getItem("blicketUser");
      const data = JSON.parse(localStorage.getItem("blicket_" + username)) || {};
      let output = '';
      for (let blook in data) {
        output += `${blook} x${data[blook]}<br>`;
      }
      document.getElementById('lockerDisplay').innerHTML = output || "No blooks yet.";
    }

    function tradeBlook() {
      const from = localStorage.getItem("blicketUser");
      const to = document.getElementById('targetUser').value.trim();
      const blook = document.getElementById('blookToSend').value.trim();
      if (!to || !blook) return alert("Fill all fields.");

      let fromData = JSON.parse(localStorage.getItem("blicket_" + from)) || {};
      let toData = JSON.parse(localStorage.getItem("blicket_" + to)) || {};

      if (!fromData[blook] || fromData[blook] <= 0) {
        return alert("You don't own that blook.");
      }

      fromData[blook]--;
      if (fromData[blook] === 0) delete fromData[blook];
      toData[blook] = (toData[blook] || 0) + 1;

      localStorage.setItem("blicket_" + from, JSON.stringify(fromData));
      localStorage.setItem("blicket_" + to, JSON.stringify(toData));
      updateLocker();

      document.getElementById('tradeMsg').textContent = `Sent ${blook} to ${to}!`;
    }

    // Auto-login if username saved
    window.onload = () => {
      const savedUser = localStorage.getItem("blicketUser");
      if (savedUser) showMain(savedUser);
    };
  </script>

</body>
</html>
